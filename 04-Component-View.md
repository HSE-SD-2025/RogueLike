# 4. Композиция (Диаграмма компонентов)

```mermaid
graph TD
    subgraph "Приложение 'Хроники Пустоши'"
        GameEngine("Game Engine (Core)")
        InputHandler("Input Handler")
        Renderer("Графический движок (Renderer)")
        World("World Engine")
        RulesEngine("Game Logic / Rules Engine")
        Persistence("Persistence Layer")
    end

    InputHandler -- "Команды (Движение, Использовать предмет)" --> GameEngine
    GameEngine -- "Обновить состояние" --> RulesEngine
    GameEngine -- "Сгенерировать сектор" --> World
    GameEngine -- "Сохранить/Загрузить игру на базе" --> Persistence
    
    RulesEngine -- "Результаты (урон, облучение, эффекты)" --> GameEngine
    World -- "Данные о секторе, аномалиях, мутантах" --> GameEngine
    
    GameEngine -- "Объекты для отрисовки" --> Renderer

    User -- "Нажатия клавиш, клики мыши" --> InputHandler
    Renderer -- "Отрисовка спрайтов" --> Window("Окно приложения")
```

### Описание компонентов

| Компонент | Описание |
| :--- | :--- |
| **Game Engine (Core)** | Оркестратор. Управляет основным игровым циклом. Связывает ввод пользователя с игровой логикой и состоянием мира. Инициирует отрисовку после каждого хода. |
| **Input Handler** | Преобразует события от клавиатуры и мыши в абстрактные игровые команды (`MoveCommand`, `UseItemCommand`). |
| **Графический движок (Renderer)** | Отвечает за всю визуализацию. Рисует тайлы карты, спрайты персонажа, мутантов, предметов, эффекты аномалий и элементы интерфейса (HUD) в окне приложения. |
| **World Engine** | Управляет миром Зоны. Генерирует и хранит данные о секторах, расположении аномалий, мутантов и предметов. |
| **Game Logic / Rules Engine** | Мозг игры. Здесь сосредоточена вся логика: расчет урона в бою, механика работы аномалий, эффекты артефактов, система радиации, простая логика поведения мутантов. |
| **Persistence Layer** | Отвечает за сохранение и загрузку состояния игры и конфигурационных файлов (монстры, предметы, артефакты). |
```
